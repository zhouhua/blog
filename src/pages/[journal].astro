---
import type { CollectionEntry } from 'astro:content';
import ArticleTitle from '@components/ArticleTitle.astro';
import Container from '@components/Container.astro';
import PageLayout from '@layouts/PageLayout.astro';
import { getExcerpt, getReadInfo } from '@lib/html';
import { cn } from '@lib/utils';
import Comment from '@react/components/Comment';
import styles from '@styles/article.module.css';
import { getCollection, render } from 'astro:content';
import dayjs from 'dayjs';

export const prerender = true;
export async function getStaticPaths() {
  const posts = await getCollection('journals');
  return posts.map((post) => {
    const date = dayjs(post.data.date).format('YYYY-MM-DD');
    return {
      params: { journal: `journal${date}` },
      props: { date, post },
    };
  });
}
interface Props {
  post: CollectionEntry<'journals'>;
  date: string;
}

const { date, post } = Astro.props;
const { Content } = await render(post);
const { timeToRead, wordCount } = getReadInfo(post.body || '');
const excerpt = getExcerpt(post.body || '');
---
<PageLayout description={excerpt} title={`éšç¬” ðŸ—“ï¸ ${date}`}>
  <ArticleTitle isJournal time={post.data.date} title={`éšç¬” ðŸ—“ï¸ ${date}`}>
    {wordCount}ä¸ªå­— &bull; {timeToRead}åˆ†é’Ÿè¯»å®Œ
  </ArticleTitle>
  <article class={cn(styles.ArticleBody)}>
    <Content />
  </article>
  <Comment client:only="react" />
  <Container>
      <div class="mb-[65px]" />
  </Container>
</PageLayout>
